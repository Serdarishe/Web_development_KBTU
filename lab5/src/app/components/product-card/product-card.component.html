<article class="product-card">

  <!-- Image -->
  <div class="card-image-wrapper">
    <img [src]="product.images[activeImageIndex]" [alt]="product.name"
      class="card-main-image" (click)="toggleGallery()" />

    <button class="arrow arrow-left" (click)="prevImage()">&#8249;</button>
    <button class="arrow arrow-right" (click)="nextImage()">&#8250;</button>

    <div class="image-counter">{{ activeImageIndex + 1 }}/{{ product.images.length }}</div>
    <div class="rating-badge">
      <span class="star-icon">‚òÖ</span> {{ product.rating }}
    </div>

    <!-- Delete button -->
    <button class="delete-btn" (click)="onDelete()" title="–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä">üóë</button>
  </div>

  <!-- Thumbnails -->
  <div class="thumbnails">
    @for (img of product.images; track $index) {
      <img
        [src]="img" [alt]="product.name" class="thumbnail"
        [class.active]="$index === activeImageIndex"
        (click)="setActiveImage($index)" />
    }
  </div>

  <!-- Content -->
  <div class="card-content">

    <div class="star-rating">
      @for (star of getStars(product.rating); track $index) {
        <span class="star"
          [class.filled]="isStarFilled($index, product.rating)"
          [class.half]="isStarHalf($index, product.rating)">‚òÖ</span>
      }
      <span class="rating-value">{{ product.rating }}</span>
    </div>

    <h3 class="product-name">
      <a [href]="product.link" target="_blank" rel="noopener noreferrer">{{ product.name }}</a>
    </h3>

    <p class="product-description">{{ product.description }}</p>

    <!-- Price -->
    <div class="price-row">
      <span class="product-price">{{ formatPrice(product.price) }}</span>
      <span class="installment-badge">{{ getInstallment(product.price) }} ‚Ç∏ √ó 3</span>
    </div>

    <!-- Actions -->
    <div class="card-actions">
      <a [href]="product.link" target="_blank" class="btn btn-primary">–ö—É–ø–∏—Ç—å</a>

      <!-- Like button -->
      <button class="btn btn-like" [class.liked]="liked" (click)="onLike()" title="–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è">
        {{ liked ? '‚ù§Ô∏è' : 'ü§ç' }} {{ product.likes }}
      </button>

      <!-- Share -->
      <div class="share-wrapper">
        <button class="btn btn-share" (click)="toggleShareMenu()" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è">&#8599;</button>
        @if (showShareMenu) {
          <div class="share-menu">
            <button class="share-option whatsapp" (click)="shareWhatsApp()">üì± WhatsApp</button>
            <button class="share-option telegram" (click)="shareTelegram()">‚úàÔ∏è Telegram</button>
          </div>
        }
      </div>
    </div>

  </div>

  <!-- Lightbox -->
  @if (showGallery) {
    <div class="gallery-overlay" (click)="toggleGallery()">
      <div class="gallery-modal" (click)="$event.stopPropagation()">
        <button class="gallery-close" (click)="toggleGallery()">‚úï</button>
        <div class="gallery-main">
          <button class="gallery-arrow left" (click)="prevImage()">&#8249;</button>
          <img [src]="product.images[activeImageIndex]" [alt]="product.name" class="gallery-main-img" />
          <button class="gallery-arrow right" (click)="nextImage()">&#8250;</button>
        </div>
        <div class="gallery-thumbs">
          @for (img of product.images; track $index) {
            <img
              [src]="img" [alt]="product.name" class="gallery-thumb"
              [class.active]="$index === activeImageIndex"
              (click)="setActiveImage($index)" />
          }
        </div>
      </div>
    </div>
  }

</article>
